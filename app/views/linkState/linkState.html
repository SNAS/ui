<div ng-controller="linkStateController" class="ls-container">

  <div class="main-page-search">
    Select BGP LS Peer
    <select ng-model="selectedPeer"
            ng-options="(peer.PeerName != '' ? peer.PeerName : peer.PeerIP + ' (' + peer.protocol + ')' ) for peer in peerData"
            ng-change="selectChange()">
    </select>
    Protocol: {{protocol}}
  </div>

  <tabset>
    <tab heading="Map View" ng-click="changeTab('map')">
      <div class="loading-section">
        <div>
          <div class="map-container relative">
            <div class="map-control router-list expanded" ng-style="{'height': mapHeight}">
              <tabset>
                <tab heading="Router List" style="width:50%">
                  <h3 class="panel-header">
                    Link State Routers
                    <div class="panel-search">
                      <input type="text" placeholder="Search..." class="search" ng-model="panelSearchKey.routerId" ng-click="panelSearch(panelSearchKey)"/>
                      <span style="color:black" class="glyphicon glyphicon-remove" ng-show="panelSearchKey" ng-click="panelSearchKey = ''"></span>
                    </div>
                  </h3>

                  <div class="main" ng-style="{'height': mapHeight - 53, 'overflow-y': 'scroll', 'padding-bottom': 0}">
                    <ul class="locations">
                      <li ng-class="{expanded: selectedLocation}" ng-repeat="(location, locaNodes) in locations | orderBy: 'location'" id="{{location}}"
                          ng-click="toggleLocationSelection(location)">
                        <p class="router-list-city">
                          <span class="glyphicon glyphicon-play"></span>{{location}}
                          <span class="count">({{locaNodes.length}})</span>
                        </p>
                        <!--<span class="go-to-location glyphicon glyphicon-search" ng-click="goto(location)"></span>-->
                        <ul class="peers locationItems" id="{{location}}nodes" hidden>
                          <li ng-repeat="node in locaNodes | filter:panelSearchKey"
                              ng-click="goto([node.latitude,node.longitude],6);selectNode(node.routerId);drawHighlightCircle([node.latitude,node.longitude],'red')">
                            <div class="row">
                              <div class="col-xs-6" tooltip-popup-delay="1000" tooltip-append-to-body="true"
                                   tooltip="Name: {{node.NodeName}}" tooltip-placement="top">{{node.NodeName}}
                              </div>
                              <div class="col-xs-6" tooltip-popup-delay="1000" tooltip-append-to-body="true"
                                   tooltip="IP: {{node.routerId}}" tooltip-placement="top">{{node.routerId}}
                              </div>
                            </div>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </div>  <!-- end of main expanded -->
                </tab>
                <tab heading="Path Trace" style="width:50%;">
                  <h3 class="panel-header">
                    Path Trace
                  </h3>
                  <div class="text-center">
                    <h3 ng-if="!pathTraces"><span class="label label-warning">No Path Found</span></h3>
                    <ul ng-if="pathTraces" ng-style="{'height': mapHeight - 53, 'overflow-y': 'scroll'}">
                      <li class="path-trace" ng-repeat="router in pathTraces"
                          tooltip="Router IP: {{router.routerIP}} | Location:{{router.city}},{{router.stateprov}},{{router.country}}"
                          ng-click="goto([router.latitude,router.longitude])">
                        <h4><span class="bmp-igp_router10-17" style="color:#55c2cc;font-size:40px"></span><span
                          class="label label-primary">Router ID:{{router.routerId}}</span>
                        </h4>
                        <span class="glyphicon glyphicon-chevron-down" ng-if="!$last"></span>
                      </li>
                    </ul>
                  </div>
                </tab>
              </tabset>
            </div> <!-- End of router-list -->
            <leaflet ng-attr-id="{{id}}" class="map" defaults="defaults" height="{{mapHeight}}" width="71.9%"></leaflet>

          </div>
          <div class="watermark" ng-if="!peerData.length">No data available</div>
        </div>
        <div bmp-loading ng-show="topologyIsLoad"></div>
      </div>

    </tab>

    <tab heading="Table View" ng-click="changeTab('table')">
      <div class="loading-section" ng-style="{'height': 'lsTableInitHeight'}">
        <div id="lsTable" ui-grid="lsTableOptions" ui-grid-selection ui-grid-resize-columns ng-if="tab=='table'" ng-style="{'height':lsTableInitHeight}"></div>
      </div>
    </tab>

  </tabset>

  <div class="main-area" style="margin-top: 15px">
    <div class="table-container">
      <h3>Topology Table {{selectedRouterID?"For "+selectedRouterID:""}}</h3>

      <div class="loading-section">
        <div ui-grid="SPFtableOptions" ui-grid-selection ui-grid-auto-resize>
          <div class="watermark" ng-show="!SPFtableOptions.data.length>0">No data available</div>
        </div>
      </div>
    </div>
  </div>

  <div class="main-area" style="margin-top: 15px" ng-show="tab=='table'">
    <div class="table-container">
      <h3>Path Trace</h3>
      <h3 ng-if="!pathTraces"><span class="label label-warning">No Path Found</span></h3>

      <div class="as-path">

        <div ng-repeat="router in pathTraces"
             style="position: relative;float: left;width:170px">
          <!--icon-->
          <div style="display: table-cell;">
            <div class="bmp-igp_router10-17" style="font-size: 50px;color:#55c2cc;margin-left:15px"
                 tooltip="Name: {{router.NodeName}}, Location:{{router.city}},{{router.stateprov}},{{router.country}}"></div>
            <div style="text-align: center">{{ router.routerId }}</div>
          </div>
          <!--line-->
          <div style="display: table-cell" ng-if="!$last">
            <div
              style="width: 120px;height: 2px;background-color:#dadada;position: absolute;margin-top: 25px;margin-left:-40px"></div>
          </div>
        </div>

      </div>

    </div>
  </div>

</div>
