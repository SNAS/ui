{% extends "base.html" %}

{% block mainsection %}
<div id="page-wrapper">

    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">BMP Dashb<img src="/static/assets/speedometer-26.png"/>ard</h1>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->

    <!-----------------------------------------------MAIN SECTION------------------------------------------------------>
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-success" style="display:none" id="as_analysis_panel">
                <div class="panel-heading">
                    <h3 align="middle"><img style="display:none" src="/static/assets/search-48.png" height="50"
                                            width="50" id="icon"/> Topology</h3>
                </div>
                <div class="panel-body">
                    <div class="form-inline">
                        <label>AS Number:</label>

                        <div class="input-append">
                            <input class="form-control" placeholder="AS Number" style="width:200px;" id="as_number">
                            <button class="btn btn-default" id="as_submit">Get it!</button>
                            <p class="help-block">Example: 701</p>

                            <div style="display:none; margin: 50px;" id="progress_bar"
                                 class="progress progress-striped active">
                                <div class="progress-bar progress-bar-success" role="progressbar"
                                     aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"
                                     style="width: 100%;">
                                    <span class="sr-only">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="analysis_tables" style="display:none">
                        <div class="col-lg-6">
                            <h3 style="width: 20%; margin: 20px auto;">Upstream</h3>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover" id="upstream_table">
                                    <thead>
                                    <tr>
                                        <th>AS #</th>
                                        <th>Prefixes</th>
                                    </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <h3 style="width: 20%; margin: 20px auto;">Downstream</h3>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover" id="downstream_table">
                                    <thead>
                                    <tr>
                                        <th>AS #</th>
                                        <th>Prefixes</th>
                                    </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--------------------./MAIN SECTION--------------------------->

</div>
<!-- /#page-wrapper -->
{% endblock %}

{% block javascripts %}
<script src="/static/js/bootstrap-progressbar.js"></script>

<script>

    $(document).ready(function () {
        $("#as_analysis_panel").show(500);
        $("#icon").show(1000);




    });

    var counter = 0
    var upstreamtable, downstreamtable

    function stopBar() {
        counter += 1;
        if (counter == 2) {
            $("#progress_bar").hide(100);
            $("#analysis_tables").show(500);
        }
    }

    //Upload tables
    $("#as_submit").click(function () {
        if (jQuery.isNumeric($('#as_number').val())) {
            $.get( "http://bgp.he.net/AS109", function( data ) {
                var el = $( '<div></div>' );
                el.html(data);

                arr = $('div.asright', el) // All the anchor elements
                console.log(arr)
            } );


            $("#analysis_tables").hide(500);
            counter = 0
            $("#progress_bar").show(500);
            if ($.fn.dataTable.isDataTable('#upstream_table')) {
                upstreamtable.destroy();
            }
            if ($.fn.dataTable.isDataTable('#downstream_table')) {
                downstreamtable.destroy();
            }
            var upstream_req = "http://odl-dev.openbmp.org:8001/db_rest/v1/upstream/" + $('#as_number').val() + "/count";
            var downstream_req = "http://odl-dev.openbmp.org:8001/db_rest/v1/downstream/" + $('#as_number').val() + "/count";

            upstreamtable = $('#upstream_table').DataTable({
                "ajax": { "url": upstream_req,
                    "dataSrc": function (json) {
                        return json.d.data;
                    }
                },
                "fnInitComplete": function () {
                    stopBar();
                },
                "columns": [
                    { "data": "UpstreamAS",
                        "defaultContent": " "
                    },
                    { "data": "Prefixes_Learned" }
                ],
                "scrollCollapse": true,
                "paging": true,
                "info": true
            });

            downstreamtable = $('#downstream_table').DataTable({
                "ajax": { "url": downstream_req,
                    "dataSrc": function (json) {
                        return json.d.data;
                    }
                },
                "fnInitComplete": function () {
                    stopBar();
                },
                "columns": [
                    { "data": "DownstreamAS",
                        "defaultContent": " "
                    },
                    { "data": "Prefixes_Learned" }
                ],
                "scrollCollapse": true,
                "paging": true,
                "info": true
            });

        }
    });

</script>
{% endblock %}

{% block styles %}

{% endblock %}