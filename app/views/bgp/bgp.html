<div ng-controller="BGPController" id="bgpView" ng-init="obj={maximiseForceDirectedGraph:false}">

  <div class="main-area clearfix" ng-class="{hidden: obj.maximiseForceDirectedGraph}">

  <!-- THIS SECTION DISPLAYS ERRORS -->
  <div class="main-area" ng-show="api_errors.length > 0">
    <div class="col-lg-12 alert alert-danger">
      <div ng-repeat="api_error in api_errors">
        <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
        {{api_error}}
      </div>
    </div>
  </div>

  <!-- THIS SECTION IS FOR DISPLAYING INFORMATION ABOUT ALL AS NODES -->

  <div class="main-area" ng-show="displayAllNodes && api_errors.length === 0" ng-class="{hidden: obj.maximiseForceDirectedGraph}">
    <div class="table-container col-lg-12 merge-columns">
      <div class="col-lg-8">
        <h3>Prefixes originated and transitted per AS</h3>
        <nvd3 options="barChartOptions" data="barChartData" id="barChart"></nvd3>
      </div>

      <div class="col-lg-4">
        <h3>Controls
          <!--<button ng-if="!error" class="btn btn-success btn-xs right" ng-click="triggerDataUpdate()">trigger update from server</button>-->
          <div ng-if="!error" class="data-offset right">
            <span class="btn btn-default btn-xs" ng-click="previousData()"><span class="glyphicon glyphicon-arrow-left"></span></span>
            Results {{offset}} to {{offset+limit}}
            <span class="btn btn-default btn-xs" ng-click="nextData()"><span class="glyphicon glyphicon-arrow-right"></span></span>
          </div>
        </h3>

        <div class="loading-section">
          <div ng-show="loadingASList" bmp-loading></div>
          <div class="grid" ui-grid-auto-resize ui-grid-resize-columns="true" ui-grid="asListGridOptions"
               ng-style="{'height': asListGridOptions.height}">
            <div class="watermark" ng-if="!asListGridOptions.data.length">No data available</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- THIS SECTION DISPLAYS A DATE TIME RANGE SELECTOR -->
  <div class="main-area" ng-show="displayTimeRangeSelector && !obj.maximiseForceDirectedGraph">
    <line-graph-time-selector graph="asChangesGraph" graph-data="previewGraphData" changed-dates-callback="changedDates(newDates)"
                              graph-height="graphHeight" loading-graph="loadingPreview"></line-graph-time-selector>
  </div>

  <!-- THIS SECTION DISPLAYS INFORMATION FOR A SPECIFIC AS NODE -->
  <!--<div class="main-area row" ng-show="displayASNInfo">-->
  <div class="main-area" ng-show="!obj.maximiseForceDirectedGraph && displayASNInfo">

    <!-- WhoIs info and prefixes -->
    
    <div class="col-lg-6">
      <div class="table-container whois">
        <h3>AS {{asn}} Information</h3>
        <div class="loading-section">
          <div ng-show="loadingWhoIs" bmp-loading font-width="50"></div>
        </div>
        <div ng-show="!loadingWhoIs">
          <div ng-show="nodata" class="col-lg-12">No results found</div>
          <div class="preStyle" ng-show="!nodata" style="height: {{prefixGridInitHeight}}px">
            <table class="tableStyle">
              <tbody>
              <tr ng-repeat="row in asnDetails">
                <td>{{row.key}}</td>
                <td class="value">{{row.value}}</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="table-container">
        <h3>Prefixes with AS Path containing AS {{asn}}</h3>

        <div class="loading-section">
          <div ng-show="loadingPrefixes" bmp-loading font-width="50"></div>
          <div ui-grid="prefixGridOptions" ui-grid-auto-resize ng-style="{'height': prefixGridOptions.height}"></div>
          <div class="watermark" ng-if="!prefixGridOptions.data.length">No data available</div>
        </div>
      </div>
    </div>
  </div>

  <!-- THIS SECTION DISPLAYS A D3 GRAPH FOR A SPECIFIC AS NODE -->

  <div class="main-area" ng-show="displayASNInfo && api_errors.length === 0">

    <!-- force directed graph -->
    <div class="col-lg-12">
      <div class="table-container" id="forceDirectedGraph" data-ng-show="showDirectedGraph">
        <h3>
          AS Links
          <div class="maximise">
            <!--<button class="btn btn-default glyphicon glyphicon-resize-full" ng-if="!obj.maximiseForceDirectedGraph"></button>-->
            <button class="button btn-icon btn-maximise" ng-if="!obj.maximiseForceDirectedGraph" ng-click="obj.maximiseForceDirectedGraph = true">
              <span class="glyphicon glyphicon-resize-full"></span>
            </button>
            <!--<div class="glyphicon glyphicon-resize-small" ng-if="maximiseForceDirectedGraph"></div>-->
            <button class="button btn-icon btn-minimise" ng-if="obj.maximiseForceDirectedGraph" ng-click="obj.maximiseForceDirectedGraph = false">
              <span class="glyphicon glyphicon-resize-small"></span>
            </button>
          </div>
        </h3>
        <div class="nv-container" ng-show="!showASGraph">
          <button class="btn btn-sm btn-primary" ng-click="loadASGraph()">Load AS Graph</button>
          Note: it can take a while...
        </div>
        <div class="nv-container" ng-show="showASGraph && !loadingASNodesAndLinksData">
          <button class="btn btn-sm btn-primary" ng-click="loadASGraph()">Refresh</button>
        </div>
        <div class="loading-section">
          <div ng-show="loadingASNodesAndLinksData" bmp-loading font-width="50"></div>
        </div>
        <div class="nv-container" ng-show="showASGraph">
          <nvd3 options="forceDirectedGraph.options" data="forceDirectedGraph.data" class="with-3d-shadow with-transitions"></nvd3>
          <div id="nodeTooltips" class="hideTooltip">
            <table>
              <tr ng-repeat="field in nodeTooltipFields" id="node-field-{{field}}">
                <td class="field">{{nodeTooltipDisplayField(field)}}</td>
                <td class="value">-</td>
              </tr>
            </table>
          </div>
          <div id="linkTooltips" class="hideTooltip">
            <table>
              <tr ng-repeat="field in linkTooltipFields" id="link-field-{{field.name}}">
                <td class="field">{{field.displayName}}</td>
                <td class="value">-</td>
              </tr>
            </table>
          </div>
          <div class="zoom-buttons" ng-show="!loadingASNodesAndLinksData">
            <button aria-label="Zoom in" id="widget-zoom-in" class="btn-icon widget-zoom-button widget-zoom-in" ng-click="controlZoom('zoom_in')">
              <span class="glyphicon glyphicon-plus"></span>
            </button>
            <button aria-label="Zoom out" id="widget-zoom-out" class="btn-icon widget-zoom-button widget-zoom-out" ng-click="controlZoom('zoom_out')">
              <span class="glyphicon glyphicon-minus"></span>
              <div class="widget-zoom-button-divider"></div>
            </button>
          </div>
          <div class="legend" ng-show="!loadingASNodesAndLinksData">
            <div class="color-label">Unstable</div>
            <ul class="colors">
              <li ng-repeat="c in stabilityColors" style="background-color: {{c.color}}"></li>
            </ul>
            <div class="color-label">Stable</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- THIS SECTION DISPLAYS INFORMATION FOR A SPECIFIC PREFIX -->

  <!--<div class="main-area row" ng-show="displayASNInfo">-->
  <div class="main-area" ng-show="!nodata && api_errors.length === 0 && !obj.maximiseForceDirectedGraph && displayPrefixInfo">

    <!-- prefixes -->
    <div class="col-lg-12">
      <div class="table-container">
        <h3>Prefixes starting with {{prefix}}</h3>

        <div class="loading-section">
          <div ng-show="loadingPrefixes" bmp-loading font-width="50"></div>
          <div ui-grid="prefixViewGridOptions" ui-grid-auto-resize ng-style="{'height': prefixGridOptions.height}"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- THIS SECTION DISPLAYS A D3 GRAPH FOR A SPECIFIC PREFIX -->

  <div class="main-area" ng-show="displayPrefixInfo && api_errors.length === 0">
    <!-- AS paths graph -->
    <div class="col-lg-12">
      <div class="table-container" id="asPathsGraph">
        <h3>AS Paths</h3>
        <div class="loading-section">
          <div ng-show="loadingPrefixes" bmp-loading font-width="50"></div>
        </div>

        <div class="as-path" ng-repeat="as_path in asPathGraph.paths | orderBy:asPathsOrderProp" ng-show="as_path.visible">
          <div class="timestamp">{{as_path.timestamp}}</div>
          <div class="prefix">{{as_path.prefix}}</div>
          <div ng-style="{'width':config.width}">
            <div ng-repeat="path in as_path.as_path" ng-style="{'width': path.addWidth}"
                 style="position: relative;float: left;">
              <!--icon-->
              <div class="as-icon-and-number" ng-click="changeLocation({{path.botVal}})">
                <span ng-if="path.noTopText">
                  <div style="text-align: center">&nbsp;</div>
                </span>

                <span ng-if="!path.noTopText">
                  <div class="as-node-name" tooltip="{{path.topVal}}" tooltip-append-to-body="true">{{ path.topVal }}</div>
                </span>

                <div class="as-node-count bg-{{ path.icon }}" ng-if="path.count > 1">{{path.count}}</div>

                <!--This is the actual AS icon-->
                <div class="{{ path.icon }} as-node-default-size"
                     data-content="{{path.popOut}}" data-html="true" popover-placement="right"
                     popover-trigger="mouseenter" popover="{{path.popOut}}" popover-append-to-body="true"></div>
                <div style="text-align: center; padding-left: {{path.leftPadding}}px">{{ path.botVal }}</div>
              </div>
              <!--line-->
              <div style="display: table-cell;" ng-if="path.isEnd">
                <div class="asPathLine" ng-style="{'width':config.lineWidth}"></div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

</div>
