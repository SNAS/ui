{% extends "base.html" %}

{% block InstabilityReport %}<li class="active">{% endblock %}

{% block mainsection %}
<div id="page-wrapper">
    <!-- /.row -->


    <div class="row">
        <!-- /.col-lg-12 -->
    </div>

    <!------------------------------------------------ Updates Over Time ---------------------------------------------->
    <div class="row sliding_panel" id="updates_over_time_section">
        <div class="panel panel-danger">
            <div class="panel-heading">
                <h3 align="middle"><img src="/static/assets/statistics-32.png"/> Updates Over Time</h3>
            </div>
            <div class="col-lg-12">
                <div class="panel-heading">
                </div>
                <div class="panel-body">
                    <h3>Count of updates</h3>

                    <div id="count_of_updates" style="min-width: 1200px; height: 400px; margin: 0 auto"></div>
                    <h3>Top prefixes by number of updates in past hours</h3>

                    <div id="top_prefixes" style="min-width: 1200px; height: 400px; margin: 0 auto"></div>
                </div>
            </div>
        </div>
    </div>

    <!-------------------------------------------------  Withdrawns Over Time ----------------------------------------->
    <div class="row sliding_panel" id="withdrawns_over_time_section">
        <div class="panel panel-danger">
            <div class="panel-heading">
                <h3 align="middle"><img src="/static/assets/error-32.png"/> Withdrawns Over Time</h3>
            </div>
            <div class="col-lg-12">
                <div class="panel-heading">
                </div>
                <div class="panel-body">
                    <h3>Count of Withdrawns</h3>

                    <div id="count_of_withdr" style="min-width: 1200px; height: 400px; margin: 0 auto"></div>
                    <h3>Top prefixes by number of Withdrawns in past hours</h3>

                    <div id="top_withdr" style="min-width: 1200px; height: 400px; margin: 0 auto"></div>
                </div>
            </div>
        </div>
    </div>


    <!--             CRAP -------------------------------->
    <!--<div class="row sliding_panel">
        &lt;!&ndash; Diagram &ndash;&gt;
        <div class="col-lg-12">
            <div class="panel panel-danger">
                <div class="panel-heading">
                    <h3 align="middle"><img src="/static/assets/error-32.png"/> Withdrawns Over Time</h3>
                </div>
                <div class="panel-body">
                    &lt;!&ndash; Nav tabs &ndash;&gt;
                    <ul class="nav nav-pills">
                        <li class="active"><a href="#updates" data-toggle="tab">Updates</a>
                        </li>
                        <li><a href="#updowninstability" data-toggle="tab">Up/Down Instability</a>
                        </li>
                    </ul>
                    &lt;!&ndash; Tab panes &ndash;&gt;
                    <div class="tab-content">
                        <div class="tab-pane fade in active" id="updates">
                            <h4>Updates Instability</h4>

                            <div class="tab-content">
                                <div class="tab-pane fade in active" id="updatestable">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-bordered table-hover"
                                               id="instabilityupdatestable">
                                            <thead>
                                            <tr>
                                                <th>Rank</th>
                                                <th>AS #</th>
                                                <th>UPDs</th>
                                                <th>%</th>
                                                <th>Prefixes</th>
                                                <th>UPDs/Prefix</th>
                                                <th>AS NAME</th>
                                            </tr>
                                            </thead>
                                        </table>
                                    </div>
                                    &lt;!&ndash; /.table-responsive &ndash;&gt;
                                </div>
                                <div class="tab-pane fade" id="updatestablechart">
                                    <div id="updateschart" style="height: 400px"></div>
                                </div>
                            </div>
                            <div class="panel-footer">
                                <button type="button" class="btn btn-success" data-toggle="tab"
                                        data-target="#updatestable">Table
                                </button>
                                <button type="button" class="btn btn-success"
                                        data-target="#updatestablechart" data-toggle="tab">Chart
                                </button>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="updowninstability">
                            <h4>Up/Down Instability</h4>

                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor
                                incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                                nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                                Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
                                fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
                                culpa qui officia deserunt mollit anim id est laborum.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        &lt;!&ndash; /.Diagram &ndash;&gt;
    </div>-->
    <!-------------------------------------------------./BGP Instability Report---------------------------------------->


</div>
<!-- /#page-wrapper -->
{% endblock %}

{% block javascripts %}

<!-- HighCharts -->
<script src="/static/Highcharts-4.0.4/js/highcharts.js"></script>
<script src="/static/Highcharts-4.0.4/js/highcharts-3d.js"></script>
<script src="/static/Highcharts-4.0.4/js/modules/exporting.js"></script>
<script src="/static/Highcharts-4.0.4/js/modules/data.js"></script>
<script src="/static/Highcharts-4.0.4/js/modules/drilldown.js"></script>
<!-- /.HighCharts -->

<!-- Getting data from remote server and showing it -->
<script>

// count_of_updates
var count_of_updates;

//top updates
var top_updates;

//count of withdr
var count_of_withdr;

// top withdr
var top_withdr

// show panel with and icon
$(document).ready(function () {

    $("#updates_over_time_section").show(1000);
    $("#withdrawns_over_time_section").show(1000);

    //$("#peer_table_section").show(500);

    req1 = "http://odl-dev.openbmp.org:8001/db_rest/v1/updates/top/interval/5"

    req2 = "http://odl-dev.openbmp.org:8001/db_rest/v1/updates/top?limit=10"

    req3 = "http://odl-dev.openbmp.org:8001/db_rest/v1/withdrawns/top/interval/5"

    req4 = "http://odl-dev.openbmp.org:8001/db_rest/v1/withdrawns/top?limit=10"

    $.getJSON(req1, function (json) {

        count_of_updates = json[""].data;

        var counts1 = [];
        var counts2 = [];
        var time = [];

        //create array with amount of prefixes
        for (var i = 0; i < count_of_updates.length; i++) {
            counts1[count_of_updates.length - 1 - i] = count_of_updates[i].Count;
            time[i] = count_of_updates[i].IntervalTime;
        }
        console.log(counts1);

        var data_arr_start = count_of_updates[count_of_updates.length - 1].IntervalTime.split(/[: \-]+/);

        var year_start = data_arr_start[0];

        var month_start = data_arr_start[1];

        var day_start = data_arr_start[2];

        var hour_start = data_arr_start[3];

        var minute_start = data_arr_start[4];

        var second_start = data_arr_start[5];

        console.log(year_start + "-" + month_start + "-" + day_start + " and " + hour_start + ":" + minute_start + ":" + second_start);

        $('#count_of_updates').highcharts({
            chart: {
                zoomType: 'x'
            },
            title: {
                text: '# of updates per interval of 5 minutes'
            },
            subtitle: {
                text: document.ontouchstart === undefined ?
                        'Click and drag in the plot area to zoom in' :
                        'Pinch the chart to zoom in'
            },
            xAxis: {
                title: {
                    text: 'Time'
                },
                type: 'datetime',
                minRange: 15 * 5 * 1000 // five minutes
            },
            yAxis: {
                title: {
                    text: 'Updates'
                }
            },
            legend: {
                enabled: false
            },
            plotOptions: {
                area: {
                    fillColor: {
                        linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1},
                        stops: [
                            [0, Highcharts.getOptions().colors[0]],
                            [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                        ]
                    },
                    marker: {
                        radius: 2
                    },
                    lineWidth: 1,
                    states: {
                        hover: {
                            lineWidth: 1
                        }
                    },
                    threshold: null
                }
            },

            series: [
                {
                    type: 'area',
                    name: 'Prefixes',
                    pointInterval: 5 * 60 * 1000,
                    pointStart: Date.UTC(year_start, month_start - 1, day_start, hour_start, minute_start, second_start),
                    data: counts1
                }
            ]
        });
    });

    $.getJSON(req2, function (json) {

        var counts2 = [];
        var prefs = [];

        top_updates = json.u.data;

        //create array with amount of prefixes
        for (var i = 0; i < top_updates.length; i++) {
            counts2[top_updates.length - 1 - i] = top_updates[i].Count;
            prefs[top_updates.length - 1 - i] = top_updates[i].Prefix + "/" + top_updates[i].PrefixLen;
        }
        console.log(counts2);


        $('#top_prefixes').highcharts({
            chart: {
                type: 'column',
                margin: 75,
                options3d: {
                    enabled: true,
                    alpha: 10,
                    beta: 25,
                    depth: 70
                }
            },
            title: {
                text: 'Top updates'
            },
            //subtitle: {
            //    text: 'top_updates'
            //},
            plotOptions: {
                column: {
                    depth: 25
                }
            },
            xAxis: {
                categories: prefs
            },
            yAxis: {
                opposite: true
            },
            series: [
                {
                    name: 'Top',
                    data: counts2
                }
            ]
        });

    });

    $.getJSON(req3, function (json) {

        count_of_withdr = json[""].data;

        var counts1 = [];
        var counts2 = [];
        var time = [];

        //create array with amount of prefixes
        for (var i = 0; i < count_of_withdr.length; i++) {
            counts1[count_of_withdr.length - 1 - i] = count_of_withdr[i].Count;
            time[i] = count_of_withdr[i].IntervalTime;
        }
        console.log(counts1);

        var data_arr_start = count_of_withdr[count_of_withdr.length - 1].IntervalTime.split(/[: \-]+/);

        var year_start = data_arr_start[0];

        var month_start = data_arr_start[1];

        var day_start = data_arr_start[2];

        var hour_start = data_arr_start[3];

        var minute_start = data_arr_start[4];

        var second_start = data_arr_start[5];

        console.log(year_start + "-" + month_start + "-" + day_start + " and " + hour_start + ":" + minute_start + ":" + second_start);

        $('#count_of_withdr').highcharts({
            chart: {
                zoomType: 'x'
            },
            title: {
                text: '# of updates per interval of 5 minutes'
            },
            subtitle: {
                text: document.ontouchstart === undefined ?
                        'Click and drag in the plot area to zoom in' :
                        'Pinch the chart to zoom in'
            },
            xAxis: {
                title: {
                    text: 'Time'
                },
                type: 'datetime',
                minRange: 15 * 5 * 1000 // five minutes
            },
            yAxis: {
                title: {
                    text: 'Updates'
                }
            },
            legend: {
                enabled: false
            },
            plotOptions: {
                area: {
                    fillColor: {
                        linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1},
                        stops: [
                            [0, Highcharts.getOptions().colors[0]],
                            [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                        ]
                    },
                    marker: {
                        radius: 2
                    },
                    lineWidth: 1,
                    states: {
                        hover: {
                            lineWidth: 1
                        }
                    },
                    threshold: null
                }
            },

            series: [
                {
                    type: 'area',
                    name: 'Prefixes',
                    pointInterval: 5 * 60 * 1000,
                    pointStart: Date.UTC(year_start, month_start - 1, day_start, hour_start, minute_start, second_start),
                    data: counts1
                }
            ]
        });
    });

    $.getJSON(req4, function (json) {

        var counts2 = [];
        var prefs = [];

        top_withdr = json.u.data;

        //create array with amount of prefixes
        for (var i = 0; i < top_withdr.length; i++) {
            counts2[top_withdr.length - 1 - i] = top_withdr[i].Count;
            prefs[top_withdr.length - 1 - i] = top_withdr[i].Prefix + "/" + top_withdr[i].PrefixLen;
            //time[i] = top_updates[i].IntervalTime;
        }
        console.log(counts2);


        $('#top_withdr').highcharts({
            chart: {
                type: 'column',
                margin: 75,
                options3d: {
                    enabled: true,
                    alpha: 10,
                    beta: 25,
                    depth: 70
                }
            },
            title: {
                text: 'Top updates'
            },
            //subtitle: {
            //    text: 'top_updates'
            //},
            plotOptions: {
                column: {
                    depth: 25
                }
            },
            xAxis: {
                categories: prefs
            },
            yAxis: {
                opposite: true
            },
            series: [
                {
                    name: 'Top',
                    data: counts2
                }
            ]
        });

    });

});







</script>


{% endblock %}

{% block styles %}

{% endblock %}